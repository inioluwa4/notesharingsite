/* ************************************************************************************** */
/*                                                                                        */
/*   Â©Bitbenderz.com ... 2017                                                             */
/*                                                                                        */
/*   @ project : jQuery stockTicker Lite                                                  */
/*   @ author  : tom@bitbenderz.com                                                       */
/*   @ version : 1.1.0                                                                    */
/*   @ updated : July, 2017                                                               */
/*   @ licnese : Dual licensed under ...                                                  */
/*               MIT (http://www.opensource.org/licenses/mit-license.php)                 */
/*               GPL (http://www.opensource.org/licenses/gpl-license.php)                 */
/*                                                                                        */
/* ************************************************************************************** */
!function(e){"use strict";e.fn.stockTicker=function(s,a){return this.each(function(){return e.fn.stockTicker.default={type:"ltr",symbols:".DJI, .IXIC, .SPX, .GSPTSE, .N225",theme:"default",refresh:300,hoverPause:!0,speed:34},e.fn.stockTicker.settings=e.extend({},e.fn.stockTicker.default,s||{}),e(this).data().clone||(e(this).data().clone=this.outerHTML),t[s]?t[s].call(this,Array.prototype.slice.call(arguments,1),a):"object"!=typeof s&&s?void e.error("Method "+s+" does not exist on jQuery.stockTicker"):t.init.call(this,Array.prototype.slice.call(arguments,1),a)})};var t={init:function(t,s){var a=e(this),i=e.fn.stockTicker.settings,r=i.symbols.toUpperCase();r=e.fn.stockTicker.cleanArray(r.split(",")).join(),a.attr("data-symbols",r).attr("data-refresh",parseInt(i.refresh,10)<10?10:parseInt(i.refresh,10)).attr("data-pause",Number(i.hoverPause)).attr("data-speed",parseInt(i.speed,10)).addClass(i.theme).addClass(i.type.toUpperCase()),e.fn.stockTicker.buildTicker(a),1==arguments[0].length&&a.trigger("ready"),e.fn.stockTicker.qetQuoteData(a)},refresh:function(t){var s=e(this);e.fn.stockTicker.qetQuoteData(s)},remove:function(t){var s=e(this),a=Number(s.attr("data-index"));clearInterval(e.fn.stockTicker.tickTimer[a]),clearInterval(e.fn.stockTicker.refreshTimer[a]),s.html(""),s.replaceWith(s.data().clone)}};e.fn.stockTicker.buildTicker=function(t){t.addClass("stockTicker"),t.width(Math.ceil(t.parent().width())-2);var s=e(".stock-ticker").length,a=t.attr("data-symbols").split(","),i="";i+='<div class="mWrap stock-ticker"><div class="mMove">';for(var r=0;r<a.length;r++)i+='<span class="mItem tickerSymbol" data-quote="'+e.trim(a[r].toUpperCase())+'"></span>';i+='</div></div><i class="af ajaxBg"></i>',t.html(i),t.attr("data-index",s)},e.fn.stockTicker.qetQuoteData=function(t){t.find("i.ajaxBg").removeClass("hide");var s=t.attr("data-index"),a=t.attr("data-symbols").split(",");1==a.length&&a.push("MSFT");var i=encodeURI(a).split(",").join("%7C"),r=("file:"===window.location.protocol?"http:":window.location.protocol)+"//quote.cnbc.com/quote-html-webservice/quote.htm?symbols="+i+"&symbolType=symbol&requestMethod=quick&exthrs=1&extMode=&fund=1&entitlement=0&skipcache=1&extendedMask=1&partnerId=2&output=jsonp&noform=1&who="+s+"&callback=?";e.getJSON(r,function(e){}).always(function(t,s,a){var i=this.url.split("&who=")[1];i=i.split("&")[0];var r,n,c,o,l,d,f,h,p,m,u,k,T,v,y,w,b,g,I,M,x=e(".stockTicker[data-index="+i+"]");if(r=Number(x.attr("data-index")),clearInterval(e.fn.stockTicker.refreshTimer[r]),"success"==s){n=t.QuickQuoteResult.QuickQuote.length,c=t.QuickQuoteResult.QuickQuote;for(var C=0;C<n;C++)x.clone(!0),o=e.trim(c[C].name),l=e.trim(c[C].symbol),d=e.trim(c[C].shortName),f=e.trim(c[C].last),h=e.trim(c[C].change),p=e.trim(c[C].change_pct),m=-1!=h.indexOf("-")?"neg":0===parseFloat(h)?"nil":"pos",m=""===o?"":m,""!==o&&(u=x.find('span[data-quote="'+l+'"]'),k=e('<span class="'+m+'"><span class="name">'+o+'</span><span class="symbol">'+d+'</span><span class="val">'+f+'</span><i class="indicator"></i><span class="change">'+h.split("+").join("").split("-").join("")+'</span><span class="pct">'+p.split("+").join("").split("-").join("")+'</span></span><i class="pipe"></i>'),u.attr("title",o),u.html(k));for(x.find(".mItem").each(function(){0===e(this).children().length&&e(this).remove()}),T=x.find(".mWrap:eq(0)"),v=Math.ceil(x.width()),y=x.hasClass("LTR")?"LTR":"RTL",e('<div class="tmpdiv stockTicker" style="position:absolute; width:100000px; left:0px; top:-400px;"></div>').appendTo("body"),w=e(".tmpdiv"),(b=T.clone(!0)).appendTo(w),g=0,b.find(".mItem").each(function(){g+=Math.ceil(e(this).width())});g<2*v;)T.find(".mMove").contents().clone(!0).appendTo(b.find(".mMove")),g=0,b.find(".mItem").each(function(){g+=Math.ceil(e(this).width())});T.html(b.html()).find(".mMove").width(g+1),w.remove(),1===Number(x.attr("data-pause"))&&T.off("mouseenter").on("mouseenter",function(t){e(this).addClass("pause")}).off("mouseleave").on("mouseleave",function(t){e(this).removeClass("pause")}),I=Number(x.attr("data-speed")),clearInterval(e.fn.stockTicker.tickTimer[r]),e.fn.stockTicker.tickTimer[r]=setInterval(function(){e.fn.stockTicker.scrollTicker(T,y)},I)}x.trigger("refresh"),setTimeout(function(){x.find("i.ajaxBg").addClass("hide")},1e3),M="success"===s?1e3*parseInt(x.attr("data-refresh"),10):1e3,e.fn.stockTicker.refreshTimer[r]=setInterval(function(){e.fn.stockTicker.qetQuoteData(x)},M)})},e.fn.stockTicker.scrollTicker=function(e,t){if(!e.hasClass("pause")){var s=e.find(".mMove"),a=Math.ceil(s.width()),i=s.find(".mItem:eq(0)"),r=Math.ceil(i.width()),n=s.find(".mItem:last"),c=Math.ceil(n.width());if("LTR"===t)if(s.css("left","-=1"),2===(o=Math.abs(parseInt(s.css("left"),10)))){l=i.clone(!0,!0).appendTo(s);s.width(a+r)}else o===r&&(i.remove(),s.css("left","0px").width(a-r));else{var o=Math.abs(parseInt(s.css("left"),10));if(0===o){var l=n.clone(!0,!0).prependTo(s);s.css("left","-"+Math.ceil(l.width())+"px").width(a+Math.ceil(l.width()))}else 2===o&&(n.remove(),s.width(a-c));s.css("left","+=1")}}},e.fn.stockTicker.cleanArray=function(e){for(var t=new Array,s=0;s<e.length;s++)e[s]&&t.push(e[s]);if(t.length>0)for(var a,i=t.length;a=--i;)for(;a--;)t[i]!==t[a]||t.splice(a,1);return t},e.fn.stockTicker.tickTimer=new Array,e.fn.stockTicker.refreshTimer=new Array}(jQuery);